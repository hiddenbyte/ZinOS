{var URI=(function(){var EXTRA_PARENT_PATHS_RE,PARENT_DIRECTORY_HANDLER,PARENT_DIRECTORY_HANDLER_RE,URI_DISALLOWED_IN_PATH_,URI_DISALLOWED_IN_SCHEME_OR_CREDENTIALS_,URI_RE_;function
parse(uriStr){var m=(''+uriStr).match(URI_RE_);return m?new URI(nullIfAbsent(m[1]),nullIfAbsent(m[2]),nullIfAbsent(m[3]),nullIfAbsent(m[4]),nullIfAbsent(m[5]),nullIfAbsent(m[6]),nullIfAbsent(m[7])):null}function
create(scheme,credentials,domain,port,path,query,fragment){var uri=new URI(encodeIfExists2(scheme,URI_DISALLOWED_IN_SCHEME_OR_CREDENTIALS_),encodeIfExists2(credentials,URI_DISALLOWED_IN_SCHEME_OR_CREDENTIALS_),encodeIfExists(domain),port>0?port.toString():null,encodeIfExists2(path,URI_DISALLOWED_IN_PATH_),null,encodeIfExists(fragment));return query&&('string'===typeof
query?uri.setRawQuery(query.replace(/[^?&=0-9A-Za-z_\-~.%]/g,encodeOne)):uri.setAllParameters(query)),uri}function
encodeIfExists(unescapedPart){return'string'==typeof unescapedPart?encodeURIComponent(unescapedPart):null}function
encodeIfExists2(unescapedPart,extra){return'string'==typeof unescapedPart?encodeURI(unescapedPart).replace(extra,encodeOne):null}function
encodeOne(ch){var n=ch.charCodeAt(0);return'%'+'0123456789ABCDEF'.charAt(n>>4&15)+'0123456789ABCDEF'.charAt(n&15)}function
normPath(path){return path.replace(/(^|\/)\.(?:\/|$)/g,'$1').replace(/\/{2,}/g,'/')}PARENT_DIRECTORY_HANDLER=new
RegExp('(/|^)(?:[^./][^/]*|\\.{2,}(?:[^./][^/]*)|\\.{3,}[^/]*)/\\.\\.(?:/|$)'),PARENT_DIRECTORY_HANDLER_RE=new
RegExp(PARENT_DIRECTORY_HANDLER),EXTRA_PARENT_PATHS_RE=/^(?:\.\.\/)*(?:\.\.$)?/;function
collapse_dots(path){var p,q,r;if(path===null)return null;p=normPath(path),r=PARENT_DIRECTORY_HANDLER_RE;for(;(q=p.replace(r,'$1'))!=p;p=q);return p}function
resolve(baseUri,relativeUri){var absoluteUri=baseUri.clone(),overridden=relativeUri.hasScheme(),absRawPath,rawPath,simplifiedPath,slash;return overridden?absoluteUri.setRawScheme(relativeUri.getRawScheme()):(overridden=relativeUri.hasCredentials()),overridden?absoluteUri.setRawCredentials(relativeUri.getRawCredentials()):(overridden=relativeUri.hasDomain()),overridden?absoluteUri.setRawDomain(relativeUri.getRawDomain()):(overridden=relativeUri.hasPort()),rawPath=relativeUri.getRawPath(),simplifiedPath=collapse_dots(rawPath),overridden?(absoluteUri.setPort(relativeUri.getPort()),simplifiedPath=simplifiedPath&&simplifiedPath.replace(EXTRA_PARENT_PATHS_RE,'')):(overridden=!!rawPath,overridden?simplifiedPath.charCodeAt(0)!==47&&(absRawPath=collapse_dots(absoluteUri.getRawPath()||'').replace(EXTRA_PARENT_PATHS_RE,''),slash=absRawPath.lastIndexOf('/')+1,simplifiedPath=collapse_dots((slash?absRawPath.substring(0,slash):'')+collapse_dots(rawPath)).replace(EXTRA_PARENT_PATHS_RE,'')):(simplifiedPath=simplifiedPath&&simplifiedPath.replace(EXTRA_PARENT_PATHS_RE,''),simplifiedPath!==rawPath&&absoluteUri.setRawPath(simplifiedPath))),overridden?absoluteUri.setRawPath(simplifiedPath):(overridden=relativeUri.hasQuery()),overridden?absoluteUri.setRawQuery(relativeUri.getRawQuery()):(overridden=relativeUri.hasFragment()),overridden&&absoluteUri.setRawFragment(relativeUri.getRawFragment()),absoluteUri}function
URI(rawScheme,rawCredentials,rawDomain,port,rawPath,rawQuery,rawFragment){this.scheme_=rawScheme,this.credentials_=rawCredentials,this.domain_=rawDomain,this.port_=port,this.path_=rawPath,this.query_=rawQuery,this.fragment_=rawFragment,this.paramCache_=null}URI.prototype.toString=function(){var
out=[];return null!==this.scheme_&&out.push(this.scheme_,':'),null!==this.domain_&&(out.push('//'),null!==this.credentials_&&out.push(this.credentials_,'@'),out.push(this.domain_),null!==this.port_&&out.push(':',this.port_.toString())),null!==this.path_&&out.push(this.path_),null!==this.query_&&out.push('?',this.query_),null!==this.fragment_&&out.push('#',this.fragment_),out.join('')},URI.prototype.clone=function(){return new
URI(this.scheme_,this.credentials_,this.domain_,this.port_,this.path_,this.query_,this.fragment_)},URI.prototype.getScheme=function(){return this.scheme_&&decodeURIComponent(this.scheme_)},URI.prototype.getRawScheme=function(){return this.scheme_},URI.prototype.setScheme=function(newScheme){return this.scheme_=encodeIfExists2(newScheme,URI_DISALLOWED_IN_SCHEME_OR_CREDENTIALS_),this},URI.prototype.setRawScheme=function(newScheme){return this.scheme_=newScheme?newScheme:null,this},URI.prototype.hasScheme=function(){return null!==this.scheme_},URI.prototype.getCredentials=function(){return this.credentials_&&decodeURIComponent(this.credentials_)},URI.prototype.getRawCredentials=function(){return this.credentials_},URI.prototype.setCredentials=function(newCredentials){return this.credentials_=encodeIfExists2(newCredentials,URI_DISALLOWED_IN_SCHEME_OR_CREDENTIALS_),this},URI.prototype.setRawCredentials=function(newCredentials){return this.credentials_=newCredentials?newCredentials:null,this},URI.prototype.hasCredentials=function(){return null!==this.credentials_},URI.prototype.getDomain=function(){return this.domain_&&decodeURIComponent(this.domain_)},URI.prototype.getRawDomain=function(){return this.domain_},URI.prototype.setDomain=function(newDomain){return this.domain_=newDomain?encodeURIComponent(newDomain):null,this},URI.prototype.setRawDomain=function(newDomain){return this.domain_=newDomain?newDomain:null,this},URI.prototype.hasDomain=function(){return null!==this.domain_},URI.prototype.getPort=function(){return this.port_&&decodeURIComponent(this.port_)},URI.prototype.setPort=function(newPort){if(newPort){newPort=Number(newPort);if(newPort!==(newPort&65535))throw new
Error('Bad port number '+newPort);this.port_=''+newPort}else this.port_=null;return this},URI.prototype.hasPort=function(){return null!==this.port_},URI.prototype.getPath=function(){return this.path_&&decodeURIComponent(this.path_)},URI.prototype.getRawPath=function(){return this.path_},URI.prototype.setPath=function(newPath){return this.path_=encodeIfExists2(newPath,URI_DISALLOWED_IN_PATH_),this},URI.prototype.setRawPath=function(newPath){return this.path_=newPath?newPath:null,this},URI.prototype.hasPath=function(){return null!==this.path_},URI.prototype.getQuery=function(){return this.query_&&decodeURIComponent(this.query_).replace(/\+/g,' ')},URI.prototype.getRawQuery=function(){return this.query_},URI.prototype.setQuery=function(newQuery){return this.paramCache_=null,this.query_=encodeIfExists(newQuery),this},URI.prototype.setRawQuery=function(newQuery){return this.paramCache_=null,this.query_=newQuery?newQuery:null,this},URI.prototype.hasQuery=function(){return null!==this.query_},URI.prototype.setAllParameters=function(params){var
i,j,k,newParams,queryBuf,separator,v;if(typeof params==='object'){if(!(params instanceof
Array)&&(params instanceof Object||Object.prototype.toString.call(params)!=='[object Array]')){newParams=[],i=-1;for(k
in params)v=params[k],'string'===typeof v&&(newParams[++i]=k,newParams[++i]=v);params=newParams}}this.paramCache_=null,queryBuf=[],separator='';for(j=0;j<params.length;)k=params[j++],v=params[j++],queryBuf.push(separator,encodeURIComponent(k.toString())),separator='&',v&&queryBuf.push('=',encodeURIComponent(v.toString()));return this.query_=queryBuf.join(''),this},URI.prototype.checkParameterCache_=function(){var
cgiParams,i,k,m,out,q;if(!this.paramCache_){q=this.query_;if(!q)this.paramCache_=[];else{cgiParams=q.split(/[&\?]/),out=[],k=-1;for(i=0;i<cgiParams.length;++i)m=cgiParams[i].match(/^([^=]*)(?:=(.*))?$/),out[++k]=decodeURIComponent(m[1]).replace(/\+/g,' '),out[++k]=decodeURIComponent(m[2]||'').replace(/\+/g,' ');this.paramCache_=out}}},URI.prototype.setParameterValues=function(key,values){var
i,k,newValueIndex,params,pc;typeof values==='string'&&(values=[values]),this.checkParameterCache_(),newValueIndex=0,pc=this.paramCache_,params=[];for(i=0,k=0;i<pc.length;i+=2)key===pc[i]?newValueIndex<values.length&&params.push(key,values[newValueIndex++]):params.push(pc[i],pc[i+1]);while(newValueIndex<values.length)params.push(key,values[newValueIndex++]);return this.setAllParameters(params),this},URI.prototype.removeParameter=function(key){return this.setParameterValues(key,[])},URI.prototype.getAllParameters=function(){return this.checkParameterCache_(),this.paramCache_.slice(0,this.paramCache_.length)},URI.prototype.getParameterValues=function(paramNameUnescaped){var
i,values;this.checkParameterCache_(),values=[];for(i=0;i<this.paramCache_.length;i+=2)paramNameUnescaped===this.paramCache_[i]&&values.push(this.paramCache_[i+1]);return values},URI.prototype.getParameterMap=function(paramNameUnescaped){var
i,key,paramMap,value;this.checkParameterCache_(),paramMap={};for(i=0;i<this.paramCache_.length;i+=2)key=this.paramCache_[i++],value=this.paramCache_[i++],key
in paramMap?paramMap[key].push(value):(paramMap[key]=[value]);return paramMap},URI.prototype.getParameterValue=function(paramNameUnescaped){var
i;this.checkParameterCache_();for(i=0;i<this.paramCache_.length;i+=2)if(paramNameUnescaped===this.paramCache_[i])return this.paramCache_[i+1];return null},URI.prototype.getFragment=function(){return this.fragment_&&decodeURIComponent(this.fragment_)},URI.prototype.getRawFragment=function(){return this.fragment_},URI.prototype.setFragment=function(newFragment){return this.fragment_=newFragment?encodeURIComponent(newFragment):null,this},URI.prototype.setRawFragment=function(newFragment){return this.fragment_=newFragment?newFragment:null,this},URI.prototype.hasFragment=function(){return null!==this.fragment_};function
nullIfAbsent(matchPart){return'string'==typeof matchPart&&matchPart.length>0?matchPart:null}return URI_RE_=new
RegExp('^(?:([^:/?#]+):)?(?://(?:([^/?#]*)@)?([^/?#:@]*)(?::([0-9]+))?)?([^?#]+)?(?:\\?([^#]*))?(?:#(.*))?$'),URI_DISALLOWED_IN_SCHEME_OR_CREDENTIALS_=/[#\/\?@]/g,URI_DISALLOWED_IN_PATH_=/[\#\?]/g,URI.parse=parse,URI.create=create,URI.resolve=resolve,URI.collapse_dots=collapse_dots,URI})(),CajolingServiceFinder,Q,clearModuleCache,defaultCajolerFinder,defaultModuleIdResolver,scriptModuleLoadMaker,xhrModuleLoadMaker;(function(){var
cache={},jsonpCallbackCount;defaultModuleIdResolver=function(thisModURL,mid){return!/\.js$/.test(mid)&&!/\.html$/.test(mid)&&(mid=mid+'.js'),URI.resolve(URI.parse(thisModURL),URI.parse(mid)).toString()},CajolingServiceFinder=function(serviceURL){return function
cajolingServiceFinder(uncajoledSourceURL,jsonpCallback){var inputMimeType;return/\.js$/.test(uncajoledSourceURL)?(inputMimeType='application/javascript'):/\.html$/.test(uncajoledSourceURL)?(inputMimeType='text/html'):(inputMimeType='application/javascript'),jsonpCallback?serviceURL+'?url='+encodeURIComponent(uncajoledSourceURL)+'&renderer=pretty'+'&input-mime-type='+inputMimeType+'&output-mime-type=application/json'+'&emit-html-in-js=true'+'&callback='+jsonpCallback+'&alt=json-in-script':serviceURL+'?url='+encodeURIComponent(uncajoledSourceURL)+'&renderer=pretty'+'&input-mime-type='+inputMimeType+'&output-mime-type=application/javascript'+'&emit-html-in-js=true'+'&alt=json'}},defaultCajolerFinder=new
CajolingServiceFinder('http://caja.appspot.com/cajole');function syncLoad(modURL){var
msg;if(cache[modURL]===undefined||Q.near(cache[modURL]).isPromise___)throw msg='The static module '+modURL+' cannot be resolved.',cajita.log(msg),new
Error(msg);return Q.near(cache[modURL])}function loadMaker(thisModURL,midResolver,cajolerFinder,asyncLoad){var
load=function(mid){return syncLoad(midResolver(thisModURL,mid))},async=function(mid){return asyncLoad(midResolver(thisModURL,mid),midResolver,cajolerFinder)},asyncAll=function(moduleNames){var
r=Q.defer(),modulePromises=[],modules={},i,waitNext;for(i=0;i<moduleNames.length;++i)modulePromises[i]=async(moduleNames[i]);return waitNext=function(idx){idx===moduleNames.length?r.resolve(modules):Q.when(modulePromises[idx],function(theModule){modules[moduleNames[idx]]=theModule,waitNext(idx+1)},function(reason){r.resolve(Q.reject(reason))})},waitNext(0),r.promise()};return load.FUNC___='load',___.setStatic(load,'async',___.markFuncFreeze(async)),___.setStatic(load,'asyncAll',___.markFuncFreeze(asyncAll)),___.primFreeze(load)}function
resolveDependency(module,load){var r=Q.defer(),count,i,m,mid,size;if(module.includedModules!==undefined&&module.includedModules.length!==0){size=module.includedModules.length,count=0;for(i=0;i<size;++i)mid=module.includedModules[i],m=load.async(mid),Q.when(m,function(childModule){++count,count===size&&r.resolve(true)},function(reason){r.resolve(Q.reject('Retrieving the module '+mid+' failed.'))})}else
r.resolve(true);return r.promise}function noop(){}function makeConcreteLoadMaker(asyncLoadFunction){return ___.markFuncFreeze(function(mid,midResolver,cajolerFinder){return midResolver===undefined&&(midResolver=defaultModuleIdResolver),cajolerFinder===undefined&&(cajolerFinder=defaultCajolerFinder),loadMaker(mid,midResolver,cajolerFinder,asyncLoadFunction)})}function
messagesToLog(moduleURL,cajolerMessages){var i,msg;if(!cajolerMessages)return;cajita.log('Messages cajoling '+moduleURL);for(i=0;i<cajolerMessages.length;++i)msg=cajolerMessages[i],cajita.log(msg.name+'('+msg.level+') '+msg.type+': '+msg.message)}function
xhrAsyncLoad(modURL,midResolver,cajolerFinder){var cajoledModURL,r,xhr;return cache[modURL]!==undefined?cache[modURL]:(r=Q.defer(),cache[modURL]=r.promise,xhr=bridal.makeXhr(),xhr.onreadystatechange=function(){var
savedModuleHandler;if(xhr.readyState===4){xhr.onreadystatechange=noop;if(xhr.status===200){savedModuleHandler=___.getNewModuleHandler(),___.setNewModuleHandler(___.primFreeze({'handle':___.markFuncFreeze(function
theHandler(module){var dependency,load,securedModule;try{load=loadMaker(modURL,midResolver,cajolerFinder,xhrAsyncLoad),module.moduleURL=modURL,securedModule=___.prepareModule(module,load),dependency=resolveDependency(module,load),Q.when(dependency,function(result){r.resolve(securedModule)},function(reason){r.resolve(Q.reject('Resolving dependency for themodule '+modURL+' failed.'))})}catch(e){r.resolve(Q.reject(e))}}),'handleUncaughtException':savedModuleHandler.handleUncaughtException}));try{eval(xhr.responseText)}finally{___.setNewModuleHandler(savedModuleHandler)}}else
r.resolve(Q.reject('Retrieving the module '+modURL+' failed, '+'status code = '+xhr.status))}},cajoledModURL=cajolerFinder(modURL),xhr.open('GET',cajoledModURL,true),typeof
xhr.overrideMimeType==='function'&&xhr.overrideMimeType('application/javascript'),xhr.send(null),r.promise)}xhrModuleLoadMaker=makeConcreteLoadMaker(xhrAsyncLoad),jsonpCallbackCount=0;function
scriptAsyncLoad(modURL,midResolver,cajolerFinder){var jsonpCallbackName,load,r,script,w;if(cache[modURL]!==undefined)return cache[modURL];r=Q.defer(),cache[modURL]=r.promise,load=loadMaker(modURL,midResolver,cajolerFinder,scriptAsyncLoad),jsonpCallbackName='___caja_mod_'+jsonpCallbackCount+++'___';function
prepareModule(moduleText){var rawModule=undefined;return(function(){var ___={'loadModule':function(m){rawModule=m}};eval(moduleText)})(),___.prepareModule(rawModule,load)}return w=window,w[jsonpCallbackName]=function(moduleJson){var
preparedModule;delete w[jsonpCallbackName],moduleJson.js?(preparedModule=prepareModule(moduleJson.js),Q.when(resolveDependency(preparedModule,load),function(result){r.resolve(preparedModule)},function(reason){r.resolve(Q.reject(reason))})):r.resolve(Q.reject('Cajoling module '+modURL+' failed')),messagesToLog(modURL,moduleJson.messages)},script=document.createElement('script'),script.src=cajolerFinder(modURL,jsonpCallbackName),script.onerror=function(){r.resolve(Q.reject('Error loading cajoled module '+modURL))},(document.getElementsByTagName('head'))[0].appendChild(script),r.promise}scriptModuleLoadMaker=makeConcreteLoadMaker(scriptAsyncLoad),clearModuleCache=___.markFuncFreeze(function(){___.forOwnKeys(cache,___.markFuncFreeze(function(k,v){delete
cache[k]}))})})(),(function(){var enqueue;function reject(reason){function rejected(op,arg1,arg2,arg3){return undefined===op?rejected:'WHEN'===op?(arg2||reject)(reason):arg1?arg1(reject(reason)):reject(reason)}return rejected.reason=reason,rejected.isPromise___=true,rejected}function
ref(value){if(null===value||undefined===value)return reject({'class':['NaO']});if('number'===typeof
value&&!isFinite(value))return reject({'class':['NaN']});function fulfilled(op,arg1,arg2,arg3){var
r;if(undefined===op)return value;switch(op){case'WHEN':r=value;break;case'GET':undefined===arg2||null===arg2?(r=value):(r=value[arg2]);break;case'POST':undefined===arg2||null===arg2?(r=reject({})):(r=value[arg2].apply(value,arg3));break;case'PUT':undefined===arg2||null===arg2?(r=reject({})):(value[arg2]=arg3,r={});break;case'DELETE':undefined===arg2||null===arg2?(r=reject({})):(delete
value[arg2],r={});break;default:r=reject({})}return arg1?arg1 .apply(null,[r]):r}return fulfilled.isPromise___=true,fulfilled}enqueue=(function(){var
active=false,pending=[],run=function(){var task=pending.shift();0===pending.length?(active=false):setTimeout(run,0),task()};return function(task){pending.push(task),active||(setTimeout(run,0),active=true)}})();function
forward(p,op,arg1,arg2,arg3){enqueue(function(){p(op,arg1,arg2,arg3)})}function
promised(value){return'function'===typeof value&&value.isPromise___===true?value:ref(value)}function
defer(){var pending=[],value;function promise(op,arg1,arg2,arg3){if(undefined===op)return pending?promise:value();pending?pending.push({'op':op,'arg1':arg1,'arg2':arg2,'arg3':arg3}):forward(value,op,arg1,arg2,arg3)}return promise.isPromise___=true,___.primFreeze({'promise':___.markFuncFreeze(promise),'resolve':___.markFuncFreeze(function(p){var
i,todo,x;if(!pending)return;todo=pending,pending=null,value=promised(p);for(i=0;i!==todo.length;i+=1)x=todo[+i],forward(value,x.op,x.arg1,x.arg2,x.arg3)})})}Q={'run':___.markFuncFreeze(enqueue),'reject':___.markFuncFreeze(reject),'ref':___.markFuncFreeze(ref),'defer':___.markFuncFreeze(defer),'near':___.markFuncFreeze(function(value){return'function'===typeof
value&&value.isPromise___===true?value():value}),'when':___.markFuncFreeze(function(value,fulfilled,rejected){var
r=defer(),done=false;return forward(promised(value),'WHEN',function(x){if(done)throw new
Error;done=true,r.resolve(ref(x)('WHEN',fulfilled,rejected))},function(reason){if(done)throw new
Error;done=true,r.resolve(rejected?rejected.apply(null,[reason]):reject(reason))}),r.promise}),'get':___.markFuncFreeze(function(target,noun){var
r=defer();return forward(promised(target),'GET',r.resolve,noun),r.promise}),'post':___.markFuncFreeze(function(target,verb,argv){var
r=defer();return forward(promised(target),'POST',r.resolve,verb,argv),r.promise}),'put':___.markFuncFreeze(function(target,noun,value){var
r=defer();return forward(promised(target),'PUT',r.resolve,noun,value),r.promise}),'remove':___.markFuncFreeze(function(target,noun){var
r=defer();return forward(promised(target),'DELETE',r.resolve,noun),r.promise})},___.primFreeze(Q)})()}